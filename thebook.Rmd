# Analyse exploratoire
# Les activités terroristes mondiales depuis 1970
## CAZAUBON Thomas - FEUILLET Laure - PLANTEC Maël

### Filtrage des données

Avant toute chose, on commence par supprimer les données du dataset qui ne nous intéressent pas, on crée ensuite un nouveau dataset, bien plus léger, qui nous servira de base de travail pour la suite.

```{r}
####################################
### PREMIER ECREMAGE DES DONNEES ###
####################################

#Lecture du dataset original
gterror = read.csv("terrorism.csv", sep=',', header=TRUE)

#Filtrage pour ne garder que les colonnes pertinentes
filtered <- subset(gterror, select=c(iyear, imonth, extended, country_txt, region_txt, provstate, city, latitude, longitude, multiple, success, suicide, attacktype1_txt, targtype1_txt, natlty1_txt, gname, nperps, claimed, weaptype1_txt, nkill, nkillter, nwound, nwoundte))

#Renommage des colonnes 
names(filtered) <- c("année", "mois", "étendu", "pays", "région", "région_locale", "ville", "latitude", "longitude", "multiple", "succès", "suicide", "type_attaque", "cible", "nationalité_ciblée", "responsable", "nombre_terroristes", "revendiqué", "type_arme", "nombre_morts", "nombre_terroristes_morts", "nombre_blessés", "nombre_terroristes_blessés")

#Sauvegarde sur csv
write.csv(filtered, "./filtered_terrorism.csv")
```
### Analyse des données
C'est parti !
```{r}
####################################
####### COMMENCER EN DOUCEUR #######
####################################

gterror = read.csv("filtered_terrorism.csv", sep=',', header=TRUE)
require("ggplot2")
require("plyr")
require("tidyr")
```
Se familiariser avec les données :
```{r}
#Nombre de victimes du terrorisme depuis 1970 : 411868
nbkills = sum(na.omit(gterror$nombre_morts))
```

```{r}
#Nombre de victimes du terrorisme par année : 2014 est l'année la plus meurtrière avec quasiment 45000 victimes !
killsPerYear = ddply(gterror, .(année), summarize,
                     total=sum(na.omit(nombre_blessés))+sum(na.omit(nombre_morts)),
                     morts=sum(na.omit(nombre_morts)))
killsPerYear = gather(data=killsPerYear, key=TYPE, value=VAL, total, morts)
plot = ggplot(killsPerYear, aes(x=année,y=VAL, color=TYPE)) + 
  geom_line(size=0.8) + geom_point(size=3) + 
  labs(title="Evolution du nombre de victimes du terrorisme dans le monde", x ="Année", y="Nombre de victimes", size=50) + 
  theme(title = element_text(size=30), axis.text.x = element_text(size=20), axis.text.y = element_text(size=20), legend.title = element_blank(), legend.text = element_text(size=20))
ggsave(plot, filename = "graphiques/killsPerYear.pdf", width=16, height=9)
```

```{r}
#Nombre de victimes du terrorisme par région du monde
killsPerRegion = ddply(gterror, .(région), summarize, morts = sum(na.omit(nombre_morts)))
killsPerRegion = killsPerRegion[order(-killsPerRegion$morts),]
plot = ggplot(killsPerRegion, aes(x=reorder(région,-morts),y=morts))+geom_bar(stat="identity")+ggtitle("Nombre de victimes du terrorisme par région")+xlab("Région")+ylab("Nombre de morts")+coord_flip()
ggsave(plot, filename = "graphiques/killsPerRegion.pdf", width=4, height=3)
```

```{r}
#Les 10 pays les plus touchés
killsPerCountry = ddply(gterror, .(pays), summarize, morts = sum(na.omit(nombre_morts)))
killsPerCountry = killsPerCountry[order(-killsPerCountry$morts),][0:10,]
plot = ggplot(killsPerCountry, aes(x=reorder(pays,-morts),y=morts, fill=pays))+geom_bar(stat="identity")+ggtitle("Les dix pays les plus touchés")+xlab("Pays")+ylab("Nombre de morts")+theme(axis.text.x = element_blank())+geom_text(aes(label=pays), vjust=0, hjust=-0.1, color="black", size=3.5, angle=90)+theme(legend.position="none")
ggsave(plot, filename = "graphiques/tenTargetedCountries.pdf", width=4, height=3)
```

```{r}
#Evolution du nombre de succès
successesPerYear = ddply(gterror, .(année), summarize, ratio = (sum(na.omit(succès))/length(année)))
plot = ggplot(successesPerYear, aes(x=année,y=ratio))+geom_line()+ggtitle("Evolution du taux de réussite des attentats.")+xlab("Année")+ylab("Taux de réussite")+theme(axis.text.x = element_text(angle=45))
ggsave(plot, filename = "graphiques/successRatioPerYear.pdf", width=4, height=3)
```

```{r}
#Nationalité la plus visée par année
mostTargetedNationality = ddply(gterror, .(année, nationalité_ciblée), summarize, morts = sum(na.omit(nombre_morts)))
mostTargetedNationality = mostTargetedNationality[order(mostTargetedNationality$année, -mostTargetedNationality$morts),]
mostTargetedNationality = ddply(mostTargetedNationality, .(année), summarize, nationalite = nationalité_ciblée[1], morts = morts[1])
plot = ggplot(mostTargetedNationality, aes(x=année,y=morts, fill = nationalite))+geom_bar(stat="identity")+ggtitle("La nationalité la plus visée par le terrorisme selon l'année")+xlab("Année")+ylab("Nombre de morts")+theme(axis.text.x = element_text(angle=45))+geom_text(aes(label=nationalite), position=position_dodge(width=0.9), vjust=0, angle = 90)
ggsave(plot, filename = "graphiques/mostTargetedNationalityPerYear.pdf", width=16, height=9)
mostTargetedNationality
```

```{r}
#SE FAMILIARISER AVEC LES ARMES :

# Je garde uniquement certaines colonnes qui m'interessent.
tw = subset(gterror, select=c(année, pays, type_attaque, responsable, type_arme, nombre_morts, nombre_blessés))

'%ni%' <- Negate('%in%')
```
```{r}
# Nombre de morts par type d'arme utilisé.
morts_par_type_arme = ddply(tw, .(type_arme), summarize, nombre_morts = sum(na.omit(nombre_morts)))

# Evolution de ce top 5 et last 5 au fil du temps
morts_par_type_arme_par_année = ddply(tw, .(type_arme, année), summarize, nombre_morts = sum(na.omit(nombre_morts)))
top5_armes = arrange(morts_par_type_arme, -morts_par_type_arme$nombre_morts)[1:5,]

top5_morts_par_type_arme_par_année = morts_par_type_arme_par_année[morts_par_type_arme_par_année$type_arme %in% top5_armes$type_arme, ]

bottom5_armes = arrange(morts_par_type_arme, -morts_par_type_arme$nombre_morts)[7:12,]
bottom5_morts_par_type_arme_par_année = morts_par_type_arme_par_année[morts_par_type_arme_par_année$type_arme %in% bottom5_armes$type_arme, ]
```
```{r}
gtop5 = ggplot(top5_morts_par_type_arme_par_année, aes(x=année, y=nombre_morts, color=type_arme)) + geom_line(aes(group=type_arme, linetype=type_arme), size= 1) + ggtitle("Top 5 des armes : Evolution des morts par année.") + xlab("Année") + ylab("Nombre de morts") + labs(color = "Arme", size = 30) + theme(title = element_text(size=30), axis.text.x = element_text(angle=45), legend.text = element_text(size=15))+ scale_colour_discrete("") + scale_linetype_manual("", values=c(1,2,3,4,5,6)) + scale_shape_manual("", values=c(17,18, 19,20,21,22))

gbottom5 = ggplot(bottom5_morts_par_type_arme_par_année, aes(x=année, y=nombre_morts, color=type_arme)) + geom_line(aes(group=type_arme, linetype=type_arme), size= 1) + ggtitle("Bottom 5 des armes : Evolution des morts par année.") + xlab("Année") + ylab("Nombre de morts") + labs(color = "Arme", size = 30) + theme(title = element_text(size=30),axis.text.x = element_text(angle=45), legend.text = element_text(size=15))+ scale_colour_discrete("") + scale_linetype_manual("", values=c(1,2,3,4,5,6)) + scale_shape_manual("", values=c(17,18, 19,20,21,22))
gtop5
gbottom5
ggsave(gtop5, filename = "graphiques/top5weaponsEvolutionOfKills.png", width=16, height=9)
ggsave(gbottom5, filename = "graphiques/bottom5weaponsEvolutionOfKills.png", width=16, height=9)
```
```{r}
# MAP ?
data = subset(gterror, select=c(latitude, longitude))
data <- subset(data, data$longitude >= -10000)
#map = plot(data$longitude, data$latitude, main="Map ?", xlab="Longitude", ylab="Latitude", pch=20)
map = ggplot( data , aes( data$longitude , data$latitude ))+ ggtitle("Le terrorisme dans le monde - 1970 à aujourd'hui.") + xlab("") + ylab("") +
  geom_point(shape = 19, colour = "black", size = 0.6, fill = NA,
    alpha = 0.1, stroke = 1) + theme(title = element_blank(), axis.line=element_blank(),
      axis.text.x=element_blank(),
      axis.text.y=element_blank(),
      axis.ticks=element_blank(),
      axis.title.x=element_blank(),
      axis.title.y=element_blank(),
      legend.position="none",
      panel.background=element_blank(),
      panel.border=element_blank(),
      panel.grid.major=element_blank(),
      panel.grid.minor=element_blank(),
      plot.background=element_blank())
ggsave(map, filename = "graphiques/map.png", width=16, height=9)
```